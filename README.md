[![General Assembly Logo](https://camo.githubusercontent.com/1a91b05b8f4d44b5bbfb83abac2b0996d8e26c92/687474703a2f2f692e696d6775722e636f6d2f6b6538555354712e706e67)](https://generalassemb.ly/education/web-development-immersive)

# Featherpen API Description

Featherpen is a content management system that allows users to create, read,
update, and delete blogs and pages. The API for this application is built with
MongoDB and Express. It provides for user authentication and CRUD actions for
posts and pages.

## Links

[Front-End Repository](https://github.com/Shake-and-Bake/cms-client)

[Deployed Back-End App](https://hidden-stream-36451.herokuapp.com/)
[Deployed Front-End App](https://shake-and-bake.github.io/cms-client/)

# Development Process

As a team, we worked together to determine what models we wanted to use for our
application. After group discussion, we determined that we wanted users to have
pages and posts (blog posts). We started out with a basic schema for each model.
Over time, we were able to easily update the schema due to the flexibility
that MongoDB provides.

Some of the biggest challenges that we faced included figuring out a way to
access just an individual user's posts and/or pages, and limiting the values
that the page schema accepted for the 'template' attribute. We were able to
solve these issues through group discussion, online research, and looking
at past issues in the issue queue.

As a team, we worked well together and regularly engaged in pair programming
sessions.

## Dependencies

Install with `npm install`.

-   [`express`](http://expressjs.com/)
-   [`mongoose`](http://mongoosejs.com/)

## Installation

1.  [Download](../../archive/master.zip) this template.
1.  Unzip and rename the template directory.
1.  Empty [`README.md`](README.md) and fill with your own content.
1.  Move into the new project and `git init`.
1.  Replace all instances of `'express-api-template'` with your app name. This
    includes `package.json`, various debugger configurations, and the MongoDB
    store.
1.  Install dependencies with `npm install`.
1.  Set a SECRET_KEY in the environment.
1.  Run the API server with `npm start`. If you want your code to be reloaded on
    change, you should `npm install -g nodemon` and use `nodemon` instead of
    `npm start`.
1.  Once everything is working, make an initial commit.

For development and testing, set the SECRET_KEY from the root of your
 repository using

```sh
echo SECRET_KEY=$(/usr/local/opt/openssl/bin/openssl rand -base64 66 | tr -d '\n') >>.env
```

In order to make requests from your deployed client application, you will need
to set `CLIENT_ORIGIN` in the environment (e.g. `heroku config:set
CLIENT_ORIGIN=https://<github-username>.github.io`).

## Structure

Dependencies are stored in [`package.json`](package.json).

Do not configure `grunt` packages directly in the
[`Gruntfile.js`](Gruntfile.js). Instead, store configurations in the
[`grunt`](grunt) directory. You won't need a top-level key, since that's
generated by the `Gruntfile.js` based on the filename of the configuration
object stored in the `grunt` directory.

Developers should store JavaScript files in [`app/controllers`](app/controllers)
 and [`app/models`](app/models).
Routes are stored in [`config/routes.js`](config/routes.js)

## API

### Authentication

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| POST   | `/sign-up`             | `users#signup`    |
| POST   | `/sign-in`             | `users#signin`    |
| PATCH  | `/change-password/:id` | `users#changepw`  |
| DELETE | `/sign-out/:id`        | `users#signout`   |

#### POST /sign-up

Request:

```sh
curl --include --request POST http://localhost:4741/sign-up \
  --header "Content-Type: application/json" \
  --data '{
    "credentials": {
      "email": "an@example.email",
      "password": "an example password",
      "password_confirmation": "an example password"
    }
  }'
```

```sh
scripts/sign-up.sh
```

Response:

```md
HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 1,
    "email": "an@example.email"
  }
}
```

#### POST /sign-in

Request:

```sh
curl --include --request POST http://localhost:4741/sign-in \
  --header "Content-Type: application/json" \
  --data '{
    "credentials": {
      "email": "an@example.email",
      "password": "an example password"
    }
  }'
```

```sh
scripts/sign-in.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 1,
    "email": "an@example.email",
    "token": "33ad6372f795694b333ec5f329ebeaaa"
  }
}
```

#### PATCH /change-password/:id

Request:

```sh
curl --include --request PATCH http://localhost:4741/change-password/$ID \
  --header "Authorization: Token token=$TOKEN" \
  --header "Content-Type: application/json" \
  --data '{
    "passwords": {
      "old": "an example password",
      "new": "super sekrit"
    }
  }'
```

```sh
ID=1 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/change-password.sh
```

Response:

```md
HTTP/1.1 204 No Content
```

#### DELETE /sign-out/:id

Request:

```sh
curl --include --request DELETE http://localhost:4741/sign-out/$ID \
  --header "Authorization: Token token=$TOKEN"
```

```sh
ID=1 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/sign-out.sh
```

Response:

```md
HTTP/1.1 204 No Content
```

### Users

| Verb | URI Pattern | Controller#Action |
|------|-------------|-------------------|
| GET  | `/users`    | `users#index`     |
| GET  | `/users/1`  | `users#show`      |

#### GET /users

Request:

```sh
curl --include --request GET http://localhost:4741/users \
  --header "Authorization: Token token=$TOKEN"
```

```sh
TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/users.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "users": [
    {
      "id": 2,
      "email": "another@example.email"
    },
    {
      "id": 1,
      "email": "an@example.email"
    }
  ]
}
```

#### GET /users/:id

Request:

```sh
curl --include --request GET http://localhost:4741/users/$ID \
  --header "Authorization: Token token=$TOKEN"
```

```sh
ID=2 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/user.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 2,
    "email": "another@example.email"
  }
}
```
### POSTS

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| POST   | `/posts`               | `posts#create`    |
| GET    | `/posts`               | `posts#index`     |
| PATCH  | `/posts/:id`           | `posts#update`    |
| DELETE | `/posts/:id`           | `posts#destroy`   |
| GET    | `/userposts/:id`       | `posts#indexUser` |

#### POST /posts

API ='http://localhost:4741'
URL_PATH='/posts'

Request:

```sh
curl "${API}${URL_PATH}" \
 --include \
 --request POST \
 --header "Content-Type: application/json" \
 --header "Authorization: Token token=${TOKEN}" \
 --data '{
   "post": {
     "title": "'"${TITLE}"'",
     "body": "'"${BODY}"'"
   }
 }'
```

Example Response:

```md
HTTP/1.1 201 Created
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
Content-Type: application/json; charset=utf-8
Content-Length: 281
ETag: W/"119-7zVSpKacYaxic9GzYq38yjUhE6M"
Date: Fri, 19 May 2017 05:23:39 GMT
Connection: keep-alive

{"post":{"__v":0,"updatedAt":"2017-05-19T05:23:39.060Z","createdAt":"2017-05-19T05:23:39.060Z","title":"Yes! Blog","body":"Our exciting testing journey continues","_owner":"591e810d08f59dd62c25dca3","_id":"591e815b08f59dd62c25dca4","id":"591e815b08f59dd62c25dca4","editable":true}}
```

#### GET /posts

API ='http://localhost:4741'
URL_PATH='/posts'

Request:

```sh
curl "${API}${URL_PATH}" \
  --include \
  --request GET
```

Example Response:

```md
HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
Content-Type: application/json; charset=utf-8
Content-Length: 10649
ETag: W/"2999-5mENn5wszL/1YS1sbW6H9aGTiJ8"
Date: Fri, 19 May 2017 05:25:03 GMT
Connection: keep-alive

{"posts":[{"_id":"591a57d81eb4623f58317800","updatedAt":"2017-05-16T01:37:28.451Z","createdAt":"2017-05-16T01:37:28.451Z","title":"Testing Blog Post","body":"Lets see if this thing works","_owner":"591a555856ef333b88ff2146","__v":0,"id":"591a57d81eb4623f58317800","editable":false},{"_id":"591a5816c56a283f91ad145f","updatedAt":"2017-05-16T01:38:30.496Z","createdAt":"2017-05-16T01:38:30.496Z","title":"Testing Blog Post","body":"Lets see if this thing works","_owner":"591a555856ef333b88ff2146","__v":0,"id":"591a5816c56a283f91ad145f","editable":false}]}
```
#### PATCH /posts/:id

API='http://localhost:4741'
URL_PATH='/posts'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request PATCH \
  --header "Content-Type: application/json" \
  --header "Authorization: Token token=${TOKEN}" \
  --data '{
    "post": {
      "body": "'"${TEXT}"'"
    }
  }'
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
ETag: W/"a-bAsFyilMr4Ra1hIU5PyoyFRunpI"
Date: Fri, 19 May 2017 05:27:02 GMT
Connection: keep-alive
```

#### DELETE /posts/:id

API='http://localhost:4741'
URL_PATH='/posts'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request DELETE \
  --header "Authorization: Token token=${TOKEN}"
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
ETag: W/"a-bAsFyilMr4Ra1hIU5PyoyFRunpI"
Date: Fri, 19 May 2017 05:27:37 GMT
Connection: keep-alive
```
#### GET /userposts/:id

API='http://localhost:4741/'
URL_PATH='/userposts'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request GET \
  --header "Authorization: Token token=${TOKEN}"\
  --header "Content-Type: application/json"
```

Example Response:

```md
HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
Content-Type: application/json; charset=utf-8
Content-Length: 285
ETag: W/"11d-N8cd/2MMxwgx9tCb7tQZpYh0JcY"
Date: Fri, 19 May 2017 05:28:35 GMT
Connection: keep-alive

{"posts":[{"_id":"591e815b08f59dd62c25dca4","updatedAt":"2017-05-19T05:23:39.060Z","createdAt":"2017-05-19T05:23:39.060Z","title":"Yes! Blog","body":"Our exciting testing journey continues","_owner":"591e810d08f59dd62c25dca3","__v":0,"id":"591e815b08f59dd62c25dca4","editable":false}]}
```

### PAGES

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| POST   | `/pages`               | `pages#create`    |
| GET    | `/pages`               | `pages#index`     |
| PATCH  | `/pages/:id`           | `pages#update`    |
| DELETE | `/pages/:id`           | `pages#destroy`   |
| GET    | `/userpages/:id`       | `pages#indexUser` |

#### POST /pages

API='http://localhost:4741'
URL_PATH='/pages'

Request:

*Note: Page schema only accepts one of three values for template attribute:
'defaultTemplate'
'coolTemplate'
'fancyTemplate'
One of these must be used as the value for template in order to successfully
create a page.

```sh
curl "${API}${URL_PATH}" \
 --include \
 --request POST \
 --header "Content-Type: application/json" \
 --header "Authorization: Token token=${TOKEN}" \
 --data '{
   "page": {
     "title": "'"${TITLE}"'",
     "body": "'"${BODY}"'",
     "footer": "'"${FOOTER}"'",
     "template": "'"${TEMPLATE}"'"

   }
 }'

```

Example Response:

```md
HTTP/1.1 201 Created
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
Content-Type: application/json; charset=utf-8
Content-Length: 326
ETag: W/"146-PYxRHyGIHaYxJvcVCZWjyXI5TRA"
Date: Fri, 19 May 2017 05:30:09 GMT
Connection: keep-alive

{"page":{"__v":0,"updatedAt":"2017-05-19T05:30:09.767Z","createdAt":"2017-05-19T05:30:09.767Z","title":"21nd Blog","body":"Our exciting testing journey continues","footer":"Foot","template":"defaultTemplate","_owner":"591e810d08f59dd62c25dca3","_id":"591e82e108f59dd62c25dca7","id":"591e82e108f59dd62c25dca7","editable":true}}
```

#### GET /pages

API='http://localhost:4741'
URL_PATH='/pages'

Request:

```sh
curl "${API}${URL_PATH}" \
  --include \
  --request GET \

```

Example Response:

```md
HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
Content-Type: application/json; charset=utf-8
Content-Length: 3066
ETag: W/"bfa-WfG3h7iloB5DcWylnb2n2djLuiA"
Date: Fri, 19 May 2017 05:31:26 GMT
Connection: keep-alive

{"pages":[{"_id":"591cad99030a294f605b5aa6","updatedAt":"2017-05-17T20:07:53.388Z","createdAt":"2017-05-17T20:07:53.388Z","title":"whaaa","body":"too cool","footer":"no","_owner":"591cacb7030a294f605b5aa1","__v":0,"id":"591cad99030a294f605b5aa6","editable":false},{"_id":"591db5457182b3818dccd9e9","updatedAt":"2017-05-18T14:52:53.772Z","createdAt":"2017-05-18T14:52:53.772Z","title":"Jon Snow","body":"His color should be white","footer":"he has been resurrected","background":"default-white","_owner":"591db4ad7182b3818dccd9e7","__v":0,"id":"591db5457182b3818dccd9e9","editable":false}]}
```
#### PATCH /pages/:id

API='http://localhost:4741'
URL_PATH='/pages'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request PATCH \
  --header "Content-Type: application/json" \
  --header "Authorization: Token token=${TOKEN}" \
  --data '{
    "page": {
      "body": "'"${TEXT}"'"
    }
  }'
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
ETag: W/"a-bAsFyilMr4Ra1hIU5PyoyFRunpI"
Date: Fri, 19 May 2017 05:32:55 GMT
Connection: keep-alive
```

#### DELETE /pages/:id

API='http://localhost:4741'
URL_PATH='/pages'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request DELETE \
  --header "Authorization: Token token=${TOKEN}"
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
ETag: W/"a-bAsFyilMr4Ra1hIU5PyoyFRunpI"
Date: Fri, 19 May 2017 05:33:41 GMT
Connection: keep-alive
```
#### GET /userposts/:id

API ='http://localhost:4741'
URL_PATH='/userpages'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request GET \
  --header "Authorization: Token token=${TOKEN}"\
  --header "Content-Type: application/json"
```

Example Response:

```md
HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: http://localhost:7165
Vary: Origin
Content-Type: application/json; charset=utf-8
Content-Length: 330
ETag: W/"14a-ekR2Tcgzr9pp0euP2r538VEbSqM"
Date: Fri, 19 May 2017 05:34:13 GMT
Connection: keep-alive

{"pages":[{"_id":"591e82e108f59dd62c25dca7","updatedAt":"2017-05-19T05:30:09.767Z","createdAt":"2017-05-19T05:30:09.767Z","title":"21nd Blog","body":"Our exciting testing journey continues","footer":"Foot","template":"defaultTemplate","_owner":"591e810d08f59dd62c25dca3","__v":0,"id":"591e82e108f59dd62c25dca7","editable":false}]}
```

## [License](LICENSE)

1.  All content is licensed under a CC­BY­NC­SA 4.0 license.
1.  All software code is licensed under GNU GPLv3. For commercial use or
    alternative licensing, please contact legal@ga.co.
