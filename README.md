[![General Assembly Logo](https://camo.githubusercontent.com/1a91b05b8f4d44b5bbfb83abac2b0996d8e26c92/687474703a2f2f692e696d6775722e636f6d2f6b6538555354712e706e67)](https://generalassemb.ly/education/web-development-immersive)

# Featherpen API Description

Featherpen is a content management system that allows users to create, read,
update, and delete blogs and pages. The API for this application is built with
MongoDB and Express. It provides for user authentication and CRUD actions for
posts and pages.

## Links

[Front-End Repository](https://github.com/Shake-and-Bake/cms-client)

[Deployed Back-End App](https://hidden-stream-36451.herokuapp.com/)
[Deployed Front-End App](https://shake-and-bake.github.io/cms-client/)

# Development Process

As a team, we worked together to determine what models we wanted to use for our
application. After group discussion, we determined that we wanted users to have
pages and posts (blog posts). We started out with a basic schema for each model.
Over time, we were able to easily update the schema due to the flexibility
that MongoDB provides.

Some of the biggest challenges that we faced included figuring out a way to
access just an individual user's posts and/or pages, and limiting the values
that the page schema accepted for the 'template' attribute. We were able to
solve these issues through group discussion, online research, and looking
at past issues in the issue queue.

As a team, we worked well together and regularly engaged in pair programming
sessions.

## Dependencies

Install with `npm install`.

-   [`express`](http://expressjs.com/)
-   [`mongoose`](http://mongoosejs.com/)

## Installation

1.  [Download](../../archive/master.zip) this template.
1.  Unzip and rename the template directory.
1.  Empty [`README.md`](README.md) and fill with your own content.
1.  Move into the new project and `git init`.
1.  Replace all instances of `'express-api-template'` with your app name. This
    includes `package.json`, various debugger configurations, and the MongoDB
    store.
1.  Install dependencies with `npm install`.
1.  Set a SECRET_KEY in the environment.
1.  Run the API server with `npm start`. If you want your code to be reloaded on
    change, you should `npm install -g nodemon` and use `nodemon` instead of
    `npm start`.
1.  Once everything is working, make an initial commit.

For development and testing, set the SECRET_KEY from the root of your
 repository using

```sh
echo SECRET_KEY=$(/usr/local/opt/openssl/bin/openssl rand -base64 66 | tr -d '\n') >>.env
```

In order to make requests from your deployed client application, you will need
to set `CLIENT_ORIGIN` in the environment (e.g. `heroku config:set
CLIENT_ORIGIN=https://<github-username>.github.io`).

## Structure

Dependencies are stored in [`package.json`](package.json).

Do not configure `grunt` packages directly in the
[`Gruntfile.js`](Gruntfile.js). Instead, store configurations in the
[`grunt`](grunt) directory. You won't need a top-level key, since that's
generated by the `Gruntfile.js` based on the filename of the configuration
object stored in the `grunt` directory.

Developers should store JavaScript files in [`app/controllers`](app/controllers)
 and [`app/models`](app/models).
Routes are stored in [`config/routes.js`](config/routes.js)

## API

### Authentication

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| POST   | `/sign-up`             | `users#signup`    |
| POST   | `/sign-in`             | `users#signin`    |
| PATCH  | `/change-password/:id` | `users#changepw`  |
| DELETE | `/sign-out/:id`        | `users#signout`   |

#### POST /sign-up

Request:

```sh
curl --include --request POST http://localhost:4741/sign-up \
  --header "Content-Type: application/json" \
  --data '{
    "credentials": {
      "email": "an@example.email",
      "password": "an example password",
      "password_confirmation": "an example password"
    }
  }'
```

```sh
scripts/sign-up.sh
```

Response:

```md
HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 1,
    "email": "an@example.email"
  }
}
```

#### POST /sign-in

Request:

```sh
curl --include --request POST http://localhost:4741/sign-in \
  --header "Content-Type: application/json" \
  --data '{
    "credentials": {
      "email": "an@example.email",
      "password": "an example password"
    }
  }'
```

```sh
scripts/sign-in.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 1,
    "email": "an@example.email",
    "token": "33ad6372f795694b333ec5f329ebeaaa"
  }
}
```

#### PATCH /change-password/:id

Request:

```sh
curl --include --request PATCH http://localhost:4741/change-password/$ID \
  --header "Authorization: Token token=$TOKEN" \
  --header "Content-Type: application/json" \
  --data '{
    "passwords": {
      "old": "an example password",
      "new": "super sekrit"
    }
  }'
```

```sh
ID=1 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/change-password.sh
```

Response:

```md
HTTP/1.1 204 No Content
```

#### DELETE /sign-out/:id

Request:

```sh
curl --include --request DELETE http://localhost:4741/sign-out/$ID \
  --header "Authorization: Token token=$TOKEN"
```

```sh
ID=1 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/sign-out.sh
```

Response:

```md
HTTP/1.1 204 No Content
```

### Users

| Verb | URI Pattern | Controller#Action |
|------|-------------|-------------------|
| GET  | `/users`    | `users#index`     |
| GET  | `/users/1`  | `users#show`      |

#### GET /users

Request:

```sh
curl --include --request GET http://localhost:4741/users \
  --header "Authorization: Token token=$TOKEN"
```

```sh
TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/users.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "users": [
    {
      "id": 2,
      "email": "another@example.email"
    },
    {
      "id": 1,
      "email": "an@example.email"
    }
  ]
}
```

#### GET /users/:id

Request:

```sh
curl --include --request GET http://localhost:4741/users/$ID \
  --header "Authorization: Token token=$TOKEN"
```

```sh
ID=2 TOKEN=33ad6372f795694b333ec5f329ebeaaa scripts/user.sh
```

Response:

```md
HTTP/1.1 200 OK
Content-Type: application/json; charset=utf-8

{
  "user": {
    "id": 2,
    "email": "another@example.email"
  }
}
```
### POSTS

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| POST   | `/posts`               | `posts#create`    |
| GET    | `/posts`               | `posts#index`     |
| PATCH  | `/posts/:id`           | `posts#update`    |
| DELETE | `/posts/:id`           | `posts#destroy`   |
| GET    | `/userposts/:id`       | `posts#indexUser` |

#### POST /posts

API = http://localhost:4741/
URL_PATH=posts

Request:

```sh
curl "${API}${URL_PATH}" \
 --include \
 --request POST \
 --header "Content-Type: application/json" \
 --header "Authorization: Token token=${TOKEN}" \
 --data '{
   "post": {
     "title": "'"${TITLE}"'",
     "body": "'"${BODY}"'"
   }
 }'
```

Example Response:

```md
HTTP/1.1 201 Created
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Content-Type: application/json; charset=utf-8
ETag: W/"8ba96f9e47500076806336e11ee43828"
Cache-Control: max-age=0, private, must-revalidate
X-Request-Id: b49dec54-e721-4153-b0a6-60b87ad51449
X-Runtime: 0.014579
Vary: Origin
Transfer-Encoding: chunked

{"goal":{"id":107,"description":"Meet George Washington","category":"Travel","status":"not started"}}
```

#### GET /posts

API = http://localhost:4741/
URL_PATH=posts

Request:

```sh
curl "${API}${URL_PATH}" \
  --include \
  --request GET
```

Example Response:

```md
HTTP/1.1 200 OK
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Content-Type: application/json; charset=utf-8
ETag: W/"d1c466e66c88d3526f5ee83ec0fbe07c"
Cache-Control: max-age=0, private, must-revalidate
X-Request-Id: 122a92a6-9fda-4367-9d3f-64550d04c6d5
X-Runtime: 0.007045
Vary: Origin
Transfer-Encoding: chunked

{"pages":[{"id":86,"description":"See Mereen","category":"Travel","status":"Not Started"},{"id":5,"description":"","category":"","status":""},{"id":107,"description":"Meet George Washington","category":"Travel","status":"not started"},{"id":83,"description":"Ride a dragon","category":"Travel","status":"Not started"},{"id":76,"description":"Go to Castle Black","category":"Travel","status":"Completed"},{"id":24,"description":"See a dragon again","category":"Travel","status":"not started"}]}
```
#### PATCH /posts/:id

API = http://localhost:4741/
URL_PATH=posts

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request PATCH \
  --header "Content-Type: application/json" \
  --header "Authorization: Token token=${TOKEN}" \
  --data '{
    "post": {
      "body": "'"${TEXT}"'"
    }
  }'
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Cache-Control: no-cache
X-Request-Id: 8b53ebec-389f-4be0-9e39-b21d7ca2035d
X-Runtime: 0.014355
Vary: Origin
```

#### DELETE /posts/:id

API = http://localhost:4741/
URL_PATH=posts

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request DELETE \
  --header "Authorization: Token token=${TOKEN}"
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Cache-Control: no-cache
X-Request-Id: 0732c309-cd0a-42f3-b340-5049fa81e47f
X-Runtime: 0.011799
Vary: Origin
```
#### GET /userposts/:id

API = http://localhost:4741/
URL_PATH=userposts

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request GET \
  --header "Authorization: Token token=${TOKEN}"\
  --header "Content-Type: application/json"
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Cache-Control: no-cache
X-Request-Id: 0732c309-cd0a-42f3-b340-5049fa81e47f
X-Runtime: 0.011799
Vary: Origin
```

### PAGES

| Verb   | URI Pattern            | Controller#Action |
|--------|------------------------|-------------------|
| POST   | `/pages`               | `pages#create`    |
| GET    | `/pages`               | `pages#index`     |
| PATCH  | `/pages/:id`           | `pages#update`    |
| DELETE | `/pages/:id`           | `pages#destroy`   |
| GET    | `/userpages/:id`       | `pages#indexUser` |

#### POST /pages

API='http://localhost:4741'
URL_PATH='/pages'

Request:

*Note: Page schema only accepts one of three values for template attribute:
'defaultTemplate'
'coolTemplate'
'fancyTemplate'
One of these must be used as the value for template in order to successfully
create a page.

```sh
curl "${API}${URL_PATH}" \
 --include \
 --request POST \
 --header "Content-Type: application/json" \
 --header "Authorization: Token token=${TOKEN}" \
 --data '{
   "page": {
     "title": "'"${TITLE}"'",
     "body": "'"${BODY}"'",
     "footer": "'"${FOOTER}"'",
     "template": "'"${TEMPLATE}"'"

   }
 }'

```

Example Response:

```md
HTTP/1.1 201 Created
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Content-Type: application/json; charset=utf-8
ETag: W/"8ba96f9e47500076806336e11ee43828"
Cache-Control: max-age=0, private, must-revalidate
X-Request-Id: b49dec54-e721-4153-b0a6-60b87ad51449
X-Runtime: 0.014579
Vary: Origin
Transfer-Encoding: chunked

{"goal":{"id":107,"description":"Meet George Washington","category":"Travel","status":"not started"}}
```

#### GET /pages

API='http://localhost:4741'
URL_PATH='/pages'

Request:

```sh
curl "${API}${URL_PATH}" \
  --include \
  --request GET \

```

Example Response:

```md
HTTP/1.1 200 OK
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Content-Type: application/json; charset=utf-8
ETag: W/"d1c466e66c88d3526f5ee83ec0fbe07c"
Cache-Control: max-age=0, private, must-revalidate
X-Request-Id: 122a92a6-9fda-4367-9d3f-64550d04c6d5
X-Runtime: 0.007045
Vary: Origin
Transfer-Encoding: chunked

{"pages":[{"id":86,"description":"See Mereen","category":"Travel","status":"Not Started"},{"id":5,"description":"","category":"","status":""},{"id":107,"description":"Meet George Washington","category":"Travel","status":"not started"},{"id":83,"description":"Ride a dragon","category":"Travel","status":"Not started"},{"id":76,"description":"Go to Castle Black","category":"Travel","status":"Completed"},{"id":24,"description":"See a dragon again","category":"Travel","status":"not started"}]}
```
#### PATCH /pages/:id

API='http://localhost:4741'
URL_PATH='/pages'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request PATCH \
  --header "Content-Type: application/json" \
  --header "Authorization: Token token=${TOKEN}" \
  --data '{
    "page": {
      "body": "'"${TEXT}"'"
    }
  }'
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Cache-Control: no-cache
X-Request-Id: 8b53ebec-389f-4be0-9e39-b21d7ca2035d
X-Runtime: 0.014355
Vary: Origin
```

#### DELETE /pages/:id

API='http://localhost:4741'
URL_PATH='/pages'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request DELETE \
  --header "Authorization: Token token=${TOKEN}"
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Cache-Control: no-cache
X-Request-Id: 0732c309-cd0a-42f3-b340-5049fa81e47f
X-Runtime: 0.011799
Vary: Origin
```
#### GET /userposts/:id

API ='http://localhost:4741'
URL_PATH='/userpages'

Request:

```sh
curl "${API}${URL_PATH}/${ID}" \
  --include \
  --request GET \
  --header "Authorization: Token token=${TOKEN}"\
  --header "Content-Type: application/json"
```

Example Response:

```md
HTTP/1.1 204 No Content
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
Cache-Control: no-cache
X-Request-Id: 0732c309-cd0a-42f3-b340-5049fa81e47f
X-Runtime: 0.011799
Vary: Origin

## [License](LICENSE)

1.  All content is licensed under a CC­BY­NC­SA 4.0 license.
1.  All software code is licensed under GNU GPLv3. For commercial use or
    alternative licensing, please contact legal@ga.co.
